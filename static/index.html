<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitch Voting App</title>
    <link rel="stylesheet" href="css/foundation.css">
    <link rel="stylesheet" href="css/app.css">
  </head>
  <body>

    
    <div class="grid-container">
      <div class="grid-x grid-padding-x">
        <div class="large-8 cell">
          <h1 id="polltitle">Your activity will appear here</h1>
        </div>
        <div class="large-4 cell">
          <a href="/auth/twitch" style="background-color:purple;" class="button login">Login to Twitch</a>
        </div>
      </div>
      <div class="grid-x grid-padding-x">
        <div class="large-6 cell text-center">
            <canvas id="myChart" width="100" height="100"></canvas>
        </div>
      </div>
     
      <ul class="tabs" data-tabs id="twitch-tabs">
	<li class="tabs-title is-active"><a href="#vote" aria-selected="true">Poll</a></li>
	<li class="tabs-title"><a href="#pictionary">Pictionary</a></li>
      </ul>
      <div class="tabs-content" data-tabs-content="twitch-tabs">
      <div class="tabs-panel is-active" id="vote"> 
      <div class="grid-x grid-padding-x">
        <div class="large-12 cell">
          <label>Question</label>
          <input id="question" type="text" placeholder="What is your poll question?" />
        </div>
      </div>
      <div class="grid-x grid-padding-x">
        <div class="large-12 cell">
          <label>Answer 1</label>
          <input id="answer1" type="text" placeholder="What is one possible answer?" />
        </div>
      </div>
      <div class="grid-x grid-padding-x">
        <div class="large-12 cell">
          <label>Answer 2</label>
          <input id="answer2" type="text" placeholder="What is one possible answer?" />
        </div>
      </div>
      <div class="grid-x grid-padding-x">
        <div class="large-12 cell">
          <label>Answer 3</label>
          <input id="answer3" type="text" placeholder="What is one possible answer?" />
        </div>
      </div>
      <div class="grid-x grid-padding-x">
        <div class="large-12 cell">
          <label>Answer 4</label>
          <input id="answer4" type="text" placeholder="What is one possible answer?" />
        </div>
      </div>
      <div class="grid-x grid-padding-x">
        <div class="large-2 cell">
          <a onClick="submitPoll()" class="button">Start Your Poll</a>
        </div>
	<div class="large-1 cell">
	  <a class="button">+</a>
	</div>
      </div>
      </div>
      <div class="tabs-panel" id="pictionary">
      <div class="grid-x grid-padding-x">
        <div class="large-12 cell">
          <label>Pictionary Word</label>
          <input id="pictionary guess" type="text" placeholder="Which word do you want your viewers to try guessing?" />
        </div>
      </div>
      </div>
      </div>
    </div>

    <script src="js/vendor/jquery.js"></script>
    <script src="js/vendor/what-input.js"></script>
    <script src="js/vendor/foundation.js"></script>
    <script src="js/app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.bundle.min.js"></script>
    <script>
      function submitPoll() {
        var question = document.getElementById('question').value;
        var answer1 = document.getElementById('answer1').value;
        var answer2 = document.getElementById('answer2').value;
        var answer3 = document.getElementById('answer3').value;
        var answer4 = document.getElementById('answer4').value;
        _xhttp.open("POST", "/api/poll" + location.search, false);
        _xhttp.setRequestHeader('Content-Type', 'application/json');
        console.log(question);
        _xhttp.send(JSON.stringify({
          "question":question,
          "answers":[answer1, answer2, answer3, answer4]
        }));
        console.log(
          {
          "question":question,
          "answers":[answer1, answer2, answer3, answer4]
          }
        );
        
      }
      var _xhttp = new XMLHttpRequest();
      var ctx = document.getElementById('myChart').getContext('2d');
      var polltitle = document.getElementById('polltitle');
      console.log(location.search);
      if (location.search) {
        //crude
        console.log("Sending");
        _xhttp.open("GET", "/api/poll" + location.search, false);
        _xhttp.send();
        var poll_labels = [];
        var poll_data = [];
        var bar_colors = [];
        var response = JSON.parse(_xhttp.responseText);
        for (var i = 0; i < response.votes.length; i++) {
          poll_labels.push(response.answers[i]);
          poll_data.push(response.votes[i]);
          bar_colors.push(["red", "orange", "blue", "yellow", "green"][i%5]);
        }
        var myDoughnutChart = new Chart(ctx, {
            type: 'doughnut',
            data: {labels: poll_labels,
        datasets: [{
            label: "My First dataset",
            backgroundColor: bar_colors,
            borderColor: 'rgb(255, 99, 132)',
            data: poll_data,
            }]},//JSON.parse(xhttp.responseText),
            options: {}
          });
        polltitle.innerText = response.question;
      }
      
    </script>
  </body>
</html>
